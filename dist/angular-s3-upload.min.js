!function(){var e=angular.module("ngS3Upload",[]);e.directive("ngS3Upload",["ngS3UploadService","$timeout","$http",function(e,t,o){function i(t,i,n,s){function a(){angular.forEach(t.files,function(o,i){!o.lastModified&&!o.lastModifiedDate||o.error||e.process(o,i,t,s).then(function(e){angular.isFunction(t.options.on_success)&&t.options.on_success("File uploaded success",e)},function(e){r("upload",o)})})}function r(e,o){s.$setValidity(e,!1),angular.isFunction(t.options["on_error_"+e])&&t.options["on_"+e](o),angular.isFunction(t.options.on_error)&&t.options.on_error(e,o),t.$emit("s3uploader:error:"+e,o),t.$emit("s3uploader:error",o),angular.isObject(o)&&(o.error=!0),p++}var l=angular.element('<input type="file">'),p=0;t.options.multiple&&l.attr("multiple","true"),l.css({opacity:0,position:"absolute",top:0,right:0,width:"100%",height:"100%"}).bind("change",function(e){var o=e.target.files;angular.forEach(o,function(e,o){t.files.push(e)}),t.$apply(),e.target.value="",t.options.immediate&&t.upload()}),i.css({position:"relative",overflow:"hidden"}).append(l),s.$render=function(){t.files=s.$viewValue},t.$watchCollection("files",function(e,o){var i=0,a=0;p=0,s.$setValidity("upload",!0),angular.forEach(e,function(e,o){if(e.error=!1,s.$setValidity("extension",!0),angular.isArray(t.options.extensions)&&t.options.extensions.length>0){var n=e.name.split(".").pop().toLowerCase();-1==t.options.extensions.indexOf(n)&&r("extension",e)}s.$setValidity("filesize",!0),t.options.filesize>0&&t.options.filesize<e.size&&r("filesize",e),e.error!==!0&&i++,a+=e.size}),t.options.limit>0&&e.length>t.options.limit?r("totalfiles",e):s.$setValidity("totalfiles",!0),t.options.totalsize>0&&t.options.totalsize<a?r("totalsize",e):s.$setValidity("totalsize",!0),n.required&&0==i&&0==p?r("required",e):s.$setValidity("required",!0)}),t.$on("s3uploader:start",function(){t.upload()}),t.upload=function(){t.start_upload_state=!0,s.$setValidity("policy_content",!0),s.$setValidity("policy_get",!0),s.$setValidity("policy_set",!0),angular.isObject(t.options.policy)?a():t.options.policyUrl?o.get(t.options.policyUrl).success(function(e,o){return angular.isObject(e)?(t.options.policy=e,void a()):void r("policy_content",e)}).error(function(e,t){r("policy_get",e)}):r("policy_set",null)}}return{restrict:"EA",link:i,require:"ngModel",scope:{options:"="}}}]),e.factory("ngS3UploadService",["$q","$timeout",function(e,t){function o(o,i,n,s){function a(e){if(e.lengthComputable){var t=e.loaded-v;v=e.loaded;var i=(new Date).getTime(),a=(i-m)/1e3;m=i,$++,b+=t/a*8,o.speed=b/$,o.progress=Math.round(100*e.loaded/e.total)}s.$setViewValue(n.files)}function r(e){var t=e.srcElement||e.target;204===t.status?(o.real=g+n.options.bucket+".s3.amazonaws.com/"+f,c(!0)):c(!1)}function l(e){c(!1)}function p(e){c(!1)}function c(e){t(function(){n.$apply(function(){o.success=e,delete o.progress,delete o.speed,delete o.cancel,delete o.upload,delete o.webkitRelativePath,delete o.lastModifiedDate,delete o.lastModified,n.start_upload_state=!1,e?u.resolve(o):u.reject(h),n.start_upload_state=!1})},0)}var u=e.defer(),d=o.name.split(".").pop().toLowerCase(),f=n.options.folder||"",g=n.options.secure&&1==n.options.secure?"https://":"http://";f+=n.options.filename?n.options.filename+"."+d:o.name.replace(" ","-");var y=new FormData;y.append("key",f),y.append("acl",n.options.acl||"public-read"),y.append("Content-Type",o.type),y.append("AWSAccessKeyId",n.options.policy.key),y.append("policy",n.options.policy.policy),y.append("signature",n.options.policy.signature),y.append("file",o);var h=new XMLHttpRequest;h.upload.addEventListener("progress",a,!1),h.addEventListener("load",r,!1),h.addEventListener("error",l,!1),h.addEventListener("abort",p,!1),h.open("POST",g+n.options.bucket+".s3.amazonaws.com/",!0),h.send(y),o.upload=!0,o.progress=!1,o.percent=0,o.cancel=function(){h.abort(),delete o};var v=0,m=(new Date).getTime(),$=0,b=0;return u.promise}return{process:o}}]),e.directive("ngS3UploadTrigger",[function(){return{restrict:"EA",scope:{ngS3UploadTrigger:"="},link:function(e,t){t.bind("click",function(){e.$parent.$broadcast("s3uploader:start")}),t.css({visibility:"hidden"}),e.$watch("ngS3UploadTrigger",function(o,i){angular.forEach(e.s3Upload,function(e,o){return e.real||t.css({visibility:"visible"}),!1})},!0)}}}]),e.filter("s3Filesize",[function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var o=["bytes","kB","MB","GB","TB","PB"],i=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(i))).toFixed(t)+" "+o[i]}}]),e.filter("s3TransferSpeed",[function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var o=["Kb/s","Kbs/s","Mbs/s","Gbs/s","Tbs/s","Pbs/s"],i=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(i))).toFixed(t)+" "+o[i]}}])}();
//# sourceMappingURL=angular-s3-upload.min.js.map